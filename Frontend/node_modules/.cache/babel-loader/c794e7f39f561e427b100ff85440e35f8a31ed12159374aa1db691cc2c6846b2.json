{"ast":null,"code":"import _objectSpread from\"/Users/merveerkan/Desktop/NurCollection/Frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import PanelTemplate from\"./PanelTemplate\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ProductCart(){const[cart,setCart]=useState([]);const[info,setInfo]=useState(null);const[products,setProducts]=useState([]);// 1. ÃœrÃ¼n listesini Ã§ek (Fiyat vb. gÃ¼ncel bilgiler iÃ§in gerekebilir)\nuseEffect(()=>{fetch(\"https://nur-collection-backend-860749273875.europe-west1.run.app/product/list\").then(res=>res.json()).then(data=>{if(data.success)setProducts(data.products);});},[]);// 2. KullanÄ±cÄ± bilgisini ve o kullanÄ±cÄ±ya Ã¶zel sepeti yÃ¼kle\nuseEffect(()=>{const storedInfo=localStorage.getItem(\"info\");if(storedInfo){const parsedInfo=JSON.parse(storedInfo);setInfo(parsedInfo);// ðŸ”¥ KRÄ°TÄ°K: Sepeti sadece bu kullanÄ±cÄ±ya Ã¶zel ID ile oku\nif(parsedInfo.person_id){const userCartKey=\"cart_\".concat(parsedInfo.person_id);const storedCart=JSON.parse(localStorage.getItem(userCartKey))||[];setCart(storedCart);}}},[]);// YardÄ±mcÄ± gÃ¶rseller\nconst productImages={1:\"/images/Swal.png\",2:\"/images/scarf1.png\",3:\"/images/Bonnet1.png\"};// Dinamik sepet anahtarÄ±\nconst cartkey=info!==null&&info!==void 0&&info.person_id?\"cart_\".concat(info.person_id):null;const decreaseQuantity=productId=>{if(!cartkey)return;const updatedCart=cart.map(item=>item.product.product_id===productId?_objectSpread(_objectSpread({},item),{},{quantity:item.quantity-1}):item).filter(item=>item.quantity>0);localStorage.setItem(cartkey,JSON.stringify(updatedCart));setCart(updatedCart);};const clearCart=()=>{if(!cartkey)return;localStorage.removeItem(cartkey);setCart([]);};const placeOrder=async()=>{if(!(info!==null&&info!==void 0&&info.person_id)){alert(\"Session error, please log in again.\");return;}if(cart.length===0){alert(\"Your basket is empty.\");return;}const totalAmount=cart.reduce((sum,i)=>sum+Number(i.product.price)*i.quantity,0);const orderData={customer_id:info.person_id,total_amount:totalAmount,items:cart.map(item=>({product_id:item.product.product_id,quantity:item.quantity,price:Number(item.product.price)}))};try{const response=await fetch(\"https://nur-collection-backend-860749273875.europe-west1.run.app/order/create\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(orderData)});const data=await response.json();if(data.success){alert(\"SipariÅŸ alÄ±ndÄ±.\");localStorage.removeItem(cartkey);setCart([]);}else{alert(\"Hata: \"+data.message);}}catch(err){alert(\"Connection error.\");}};// UI render kÄ±smÄ± (return) aynÄ± kalÄ±yor...\nreturn/*#__PURE__*/_jsx(PanelTemplate,{title:\"Product Cart\",rightContent:/*#__PURE__*/_jsxs(\"div\",{className:\"cart-layout\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cart-products\",children:cart.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"Your shopping cart is currently empty.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"product-gridcart\",children:cart.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"product-card\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.product.image_url&&item.product.image_url!==\"/images/default.png\"?item.product.image_url:productImages[item.product.category_id]||\"/images/default.png\",alt:item.product.product_name,style:{width:\"100%\",height:\"200px\",objectFit:\"cover\"},onError:e=>{e.target.src=\"/images/default.png\";}}),/*#__PURE__*/_jsx(\"h3\",{children:item.product.product_name}),/*#__PURE__*/_jsxs(\"p\",{children:[item.product.price,\" \\u20BA x \",item.quantity]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>decreaseQuantity(item.product.product_id),children:\"Adet Azalt\"})]},item.product.product_id))})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-payment\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Summary\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total: \",cart.reduce((sum,i)=>sum+i.quantity*Number(i.product.price),0),\" \\u20BA\"]}),cart.length>0&&/*#__PURE__*/_jsx(\"button\",{className:\"pay-btn\",onClick:placeOrder,children:\"Proceed to payment\"}),/*#__PURE__*/_jsx(\"button\",{className:\"clear-btn\",onClick:clearCart,children:\"Clear Cart\"})]})]})});}export default ProductCart;","map":{"version":3,"names":["React","useState","useEffect","PanelTemplate","jsx","_jsx","jsxs","_jsxs","ProductCart","cart","setCart","info","setInfo","products","setProducts","fetch","then","res","json","data","success","storedInfo","localStorage","getItem","parsedInfo","JSON","parse","person_id","userCartKey","concat","storedCart","productImages","cartkey","decreaseQuantity","productId","updatedCart","map","item","product","product_id","_objectSpread","quantity","filter","setItem","stringify","clearCart","removeItem","placeOrder","alert","length","totalAmount","reduce","sum","i","Number","price","orderData","customer_id","total_amount","items","response","method","headers","body","message","err","title","rightContent","className","children","src","image_url","category_id","alt","product_name","style","width","height","objectFit","onError","e","target","onClick"],"sources":["/Users/merveerkan/Desktop/NurCollection/Frontend/src/pages/ProductCart.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport PanelTemplate from \"./PanelTemplate\";\n\nfunction ProductCart() {\n    const [cart, setCart] = useState([]);\n    const [info, setInfo] = useState(null);\n    const [products, setProducts] = useState([]);\n\n    // 1. ÃœrÃ¼n listesini Ã§ek (Fiyat vb. gÃ¼ncel bilgiler iÃ§in gerekebilir)\n    useEffect(() => {\n        fetch(\"https://nur-collection-backend-860749273875.europe-west1.run.app/product/list\")\n            .then(res => res.json())\n            .then(data => {\n                if (data.success) setProducts(data.products);\n            });\n    }, []);\n\n    // 2. KullanÄ±cÄ± bilgisini ve o kullanÄ±cÄ±ya Ã¶zel sepeti yÃ¼kle\n    useEffect(() => {\n        const storedInfo = localStorage.getItem(\"info\");\n        if (storedInfo) {\n            const parsedInfo = JSON.parse(storedInfo);\n            setInfo(parsedInfo);\n\n            // ðŸ”¥ KRÄ°TÄ°K: Sepeti sadece bu kullanÄ±cÄ±ya Ã¶zel ID ile oku\n            if (parsedInfo.person_id) {\n                const userCartKey = `cart_${parsedInfo.person_id}`;\n                const storedCart = JSON.parse(localStorage.getItem(userCartKey)) || [];\n                setCart(storedCart);\n            }\n        }\n    }, []);\n\n    // YardÄ±mcÄ± gÃ¶rseller\n    const productImages = {\n        1: \"/images/Swal.png\",\n        2: \"/images/scarf1.png\",\n        3: \"/images/Bonnet1.png\",\n    };\n\n    // Dinamik sepet anahtarÄ±\n    const cartkey = info?.person_id ? `cart_${info.person_id}` : null;\n\n    const decreaseQuantity = (productId) => {\n        if (!cartkey) return;\n        const updatedCart = cart\n            .map(item =>\n                item.product.product_id === productId\n                    ? { ...item, quantity: item.quantity - 1 }\n                    : item\n            )\n            .filter(item => item.quantity > 0);\n\n        localStorage.setItem(cartkey, JSON.stringify(updatedCart));\n        setCart(updatedCart);\n    };\n\n    const clearCart = () => {\n        if (!cartkey) return;\n        localStorage.removeItem(cartkey);\n        setCart([]);\n    };\n\n    const placeOrder = async () => {\n        if (!info?.person_id) {\n            alert(\"Session error, please log in again.\");\n            return;\n        }\n        if (cart.length === 0) {\n            alert(\"Your basket is empty.\");\n            return;\n        }\n\n        const totalAmount = cart.reduce((sum, i) => sum + Number(i.product.price) * i.quantity, 0);\n\n        const orderData = {\n            customer_id: info.person_id,\n            total_amount: totalAmount,\n            items: cart.map(item => ({\n                product_id: item.product.product_id,\n                quantity: item.quantity,\n                price: Number(item.product.price)\n            }))\n        };\n\n        try {\n            const response = await fetch(\"https://nur-collection-backend-860749273875.europe-west1.run.app/order/create\", {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify(orderData)\n            });\n            const data = await response.json();\n            if (data.success) {\n                alert(\"SipariÅŸ alÄ±ndÄ±.\");\n                localStorage.removeItem(cartkey);\n                setCart([]);\n            } else {\n                alert(\"Hata: \" + data.message);\n            }\n        } catch (err) {\n            alert(\"Connection error.\");\n        }\n    };\n\n    // UI render kÄ±smÄ± (return) aynÄ± kalÄ±yor...\n    return (\n        <PanelTemplate\n            title=\"Product Cart\"\n            rightContent={\n                <div className=\"cart-layout\">\n                    <div className=\"cart-products\">\n                        {cart.length === 0 ? <p>Your shopping cart is currently empty.</p> : (\n                            <div className=\"product-gridcart\">\n                                {cart.map(item => (\n                                    <div className=\"product-card\" key={item.product.product_id}>\n                                        <img\n                                            src={item.product.image_url && item.product.image_url !== \"/images/default.png\" ? item.product.image_url : (productImages[item.product.category_id] || \"/images/default.png\")}\n                                            alt={item.product.product_name}\n                                            style={{ width: \"100%\", height: \"200px\", objectFit: \"cover\" }}\n                                            onError={(e) => { e.target.src = \"/images/default.png\"; }}\n                                        />\n                                        <h3>{item.product.product_name}</h3>\n                                        <p>{item.product.price} â‚º x {item.quantity}</p>\n                                        <button onClick={() => decreaseQuantity(item.product.product_id)}>Adet Azalt</button>\n                                    </div>\n                                ))}\n                            </div>\n                        )}\n                    </div>\n                    <div className=\"cart-payment\">\n                        <h3>Summary</h3>\n                        <p>Total: {cart.reduce((sum, i) => sum + i.quantity * Number(i.product.price), 0)} â‚º</p>\n                        {cart.length > 0 && <button className=\"pay-btn\" onClick={placeOrder}>Proceed to payment</button>}\n                        <button className=\"clear-btn\" onClick={clearCart}>Clear Cart</button>\n                    </div>\n                </div>\n            }\n        />\n    );\n}\n\nexport default ProductCart;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}